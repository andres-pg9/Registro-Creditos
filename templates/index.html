<!DOCTYPE html>
<html lang="es">

<head>
    <!-- Meta tags esenciales -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gestión de Créditos - Delta Data Consulting</title>

    <!-- Hojas de estilo externas -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/633/633611.png">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

    <script defer src="{{ url_for('static', filename='script.js') }}"></script>
    
</head>

<body class="d-flex flex-column min-vh-100">

    <!--NAVBAR-->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold mx-auto" href="#"
                style="font-family: 'Poppins', sans-serif; font-size: 2rem;">
                <i class="bi bi-credit-card-2-front me-2"></i>
                Gestión de Créditos
            </a>
        </div>
    </nav>

    <!--CONTENIDO PRINCIPAL-->
    <main class="container py-4 flex-grow-1">

        <!-- SECCIÓN: REGISTRO DE CRÉDITOS -->
        <section class="registration-section">
            <h2 class="mt-5 mb-4">Registro de Créditos</h2>

            <!-- Formulario de registro -->
            <form id="creditoForm" class="mb-5">
                <div class="row g-3">
                    <!-- Campo Cliente -->
                    <div class="col-md-6">
                        <label for="cliente" class="form-label visually-hidden">Cliente</label>
                        <input type="text" class="form-control" name="cliente" id="cliente"
                            placeholder="Nombre del Cliente" required maxlength="100" />
                    </div>

                    <!-- Campo Monto -->
                    <div class="col-md-6">
                        <label for="monto" class="form-label visually-hidden">Monto</label>
                        <input type="number" class="form-control" name="monto" id="monto"
                            placeholder="Monto del Crédito ($)" required min="1" step="0.01" />
                    </div>

                    <!-- Campo Tasa de Interés -->
                    <div class="col-md-6">
                        <label for="tasa_interes" class="form-label visually-hidden">Tasa de Interés</label>
                        <input type="number" step="0.01" class="form-control" name="tasa_interes" id="tasa_interes"
                            placeholder="Tasa de Interés (%)" required min="0.01" max="100" />
                    </div>

                    <!-- Campo Plazo -->
                    <div class="col-md-6">
                        <label for="plazo" class="form-label visually-hidden">Plazo</label>
                        <input type="number" class="form-control" name="plazo" id="plazo" placeholder="Plazo en Meses"
                            required min="1" max="360" />
                    </div>

                    <!-- Campo Fecha -->
                    <div class="col-md-6">
                        <label for="fecha_otorgamiento" class="form-label">Fecha de Otorgamiento</label>
                        <input type="date" class="form-control" name="fecha_otorgamiento" id="fecha_otorgamiento"
                            required />
                    </div>

                    <!-- Botón de envío -->
                    <div class="col-12">
                        <button type="submit" class="btn btn-success btn-lg">
                            <i class="fas fa-plus-circle"></i> Registrar Crédito
                        </button>
                    </div>
                </div>
            </form>
        </section>

        <!-- SECCIÓN: LISTADO DE CRÉDITOS -->
        <section class="listing-section">
            <h2 class="mt-5 mb-4">Listado de Créditos</h2>

            <!-- Tabla responsiva -->
            <div class="table-responsive">
                <table class="table table-striped table-hover" id="tablaCreditos">
                    <thead class="table-dark">
                        <tr>
                            <th scope="col">ID</th>
                            <th scope="col">Cliente</th>
                            <th scope="col">Monto ($)</th>
                            <th scope="col">Tasa (%)</th>
                            <th scope="col">Plazo (meses)</th>
                            <th scope="col">Fecha</th>
                            <th scope="col">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Créditos dinámicos con JS -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- SECCIÓN: MÉTRICAS Y EVOLUCIÓN -->
        <section class="metrics-section">
            <h2 class="mt-5 mb-4">Evolución de Créditos por Mes</h2>

            <!-- Tarjetas de métricas principales -->
            <div class="row mb-4 g-3">
                <!-- Monto Total -->
                <div class="col-md-4">
                    <div class="card text-center shadow-sm h-100">
                        <div class="card-body d-flex flex-column justify-content-center">
                            <h5 class="card-title">Monto Total Otorgado</h5>
                            <p id="montoTotal" class="display-6 fw-bold text-success mb-0">$0</p>
                        </div>
                    </div>
                </div>

                <!-- Clientes Únicos -->
                <div class="col-md-4">
                    <div class="card text-center shadow-sm h-100">
                        <div class="card-body d-flex flex-column justify-content-center">
                            <h5 class="card-title">Clientes Únicos</h5>
                            <p id="totalClientes" class="display-6 fw-bold text-primary mb-0">0</p>
                        </div>
                    </div>
                </div>

                <!-- Total de Créditos -->
                <div class="col-md-4">
                    <div class="card text-center shadow-sm h-100">
                        <div class="card-body d-flex flex-column justify-content-center">
                            <h5 class="card-title">Total de Créditos</h5>
                            <p id="totalCreditos" class="display-6 fw-bold text-info mb-0">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gráfica de evolución -->
            <div class="card shadow-sm mb-5">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">Evolución Mensual de Créditos</h5>
                </div>
                <div class="card-body p-4">
                    <canvas id="graficaEvolucion" style="height: 300px; width: 100%;"></canvas>
                </div>
            </div>
        </section>

        <!-- SECCIÓN: DISTRIBUCIÓN DE CRÉDITOS -->
        <section class="distribution-section">
            <h2 class="mt-5 mb-4">Distribución de Créditos</h2>

            <!-- Métricas de distribución -->
            <div class="row justify-content-center mb-4 g-3">
                <div class="col-md-3">
                    <div class="card text-center shadow-sm">
                        <div class="card-body p-3">
                            <h6 class="card-title">Clientes Únicos</h6>
                            <p id="cardClientes" class="display-6 fw-bold text-primary mb-0">0</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="card text-center shadow-sm">
                        <div class="card-body p-3">
                            <h6 class="card-title">Promedio por Cliente</h6>
                            <p id="promedioCliente" class="display-6 fw-bold text-success mb-0">$0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gráficas de distribución -->
            <div class="row mb-5 g-3">
                <!-- Gráfica por Cliente -->
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="card-header bg-info text-white">
                            <h5 class="text-center mb-0">Distribución por Cliente</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="graficaClientes" style="max-height: 300px;"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Gráfica por Rangos -->
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="text-center mb-0">Por Rangos de Montos</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="graficaRangos" style="max-height: 300px;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- MODALES -->

    <!-- Modal de Éxito -->
    <div class="modal fade" id="modalExito" tabindex="-1" aria-labelledby="modalExitoLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="modalExitoLabel">
                        <i class="fas fa-check-circle"></i> ¡Éxito!
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Cerrar"></button>
                </div>
                <div class="modal-body text-center">
                    <p class="mb-0">El crédito se registró exitosamente</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-success" data-bs-dismiss="modal">Continuar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Editar Crédito -->
    <div class="modal fade" id="editarModal" tabindex="-1" aria-labelledby="editarModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="editarModalLabel">
                        <i class="fas fa-edit"></i> Editar Crédito
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <form id="editarForm">
                        <input type="hidden" name="id" id="editId" />

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="editCliente" class="form-label">Cliente</label>
                                <input type="text" class="form-control" id="editCliente" required maxlength="100" />
                            </div>

                            <div class="col-md-6">
                                <label for="editMonto" class="form-label">Monto ($)</label>
                                <input type="number" class="form-control" id="editMonto" required min="1" step="0.01" />
                            </div>

                            <div class="col-md-6">
                                <label for="editTasa" class="form-label">Tasa de Interés (%)</label>
                                <input type="number" step="0.01" class="form-control" id="editTasa" required min="0.01"
                                    max="100" />
                            </div>

                            <div class="col-md-6">
                                <label for="editPlazo" class="form-label">Plazo (meses)</label>
                                <input type="number" class="form-control" id="editPlazo" required min="1" max="360" />
                            </div>

                            <div class="col-12">
                                <label for="editFecha" class="form-label">Fecha de Otorgamiento</label>
                                <input type="date" class="form-control" id="editFecha" required />
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Guardar Cambios
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmación de Eliminación -->
    <div class="modal fade" id="eliminarModal" tabindex="-1" aria-labelledby="eliminarModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="eliminarModalLabel">
                        <i class="fas fa-exclamation-triangle"></i> Confirmar Eliminación
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <i class="fas fa-question-circle fa-3x text-warning mb-3"></i>
                        <p id="mensajeEliminar" class="lead"></p>
                        <small class="text-muted">Esta acción no se puede deshacer.</small>
                    </div>
                    <input type="hidden" id="deleteId">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="button" class="btn btn-danger" id="btnConfirmarEliminar">
                        <i class="fas fa-trash"></i> Eliminar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!--FOOTER-->
    <footer class="text-white text-center py-3 mt-5 w-100">
        <div class="container-fluid">
            <p class="mb-0">
                © 2025 Gestión de Créditos |
                <strong>Delta Data Consulting</strong> |
                Desarrollado usando Flask
            </p>
        </div>
    </footer>

    <!-- SCRIPTS -->
    <!-- Chart.js para gráficas -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>